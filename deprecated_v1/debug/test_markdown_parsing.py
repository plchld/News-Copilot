#!/usr/bin/env python3
"""Test markdown parsing for fact-check responses"""

import sys
import os
sys.path.insert(0, os.path.join(os.path.dirname(__file__), '..'))

from api.utils.markdown_parser import FactCheckParser, JargonParser, ViewpointsParser

# Test fact-check markdown
fact_check_markdown = """
## Έλεγχος Ισχυρισμών

### Ισχυρισμός 1: Η κυβέρνηση ανακοίνωσε αύξηση 10% στον κατώτατο μισθό
**Αξιολόγηση**: ισχυρά τεκμηριωμένο
**Εξήγηση**: Η ανακοίνωση έγινε από τον Υπουργό Εργασίας στις 15/1/2024 και επιβεβαιώνεται από πολλαπλές πηγές. Η αύξηση είναι ακριβώς 10% και θα ισχύσει από την 1η Μαρτίου.
**Πηγές**:
- Υπουργείο Εργασίας - Επίσημη ανακοίνωση
- Καθημερινή - Άρθρο 15/1/2024
- ΤΑ ΝΕΑ - Ρεπορτάζ 15/1/2024

### Ισχυρισμός 2: Οι συντάξεις θα αυξηθούν κατά 15%
**Αξιολόγηση**: μερικώς τεκμηριωμένο
**Εξήγηση**: Υπάρχει πρόθεση για αυξήσεις αλλά το ποσοστό δεν έχει οριστικοποιηθεί. Οι πληροφορίες μιλούν για 8-12% και όχι 15%.
**Πηγές**:
- Υπουργείο Οικονομικών - Δηλώσεις
- Πρώτο Θέμα - Ανάλυση

## Ποιότητα Πηγών
**Πρωτογενείς πηγές**: 3
**Δευτερογενείς πηγές**: 2
**Ποικιλία πηγών**: υψηλή
"""

# Test jargon markdown
jargon_markdown = """
## Επεξήγηση Όρων

**ENFIA**: Ο Ενιαίος Φόρος Ιδιοκτησίας Ακινήτων είναι ο ετήσιος φόρος που πληρώνουν όλοι οι ιδιοκτήτες ακινήτων στην Ελλάδα. Υπολογίζεται με βάση την αντικειμενική αξία του ακινήτου.

**Spread**: Η διαφορά μεταξύ του επιτοκίου δανεισμού της Ελλάδας και της Γερμανίας. Όσο μικρότερο το spread, τόσο φθηνότερα δανείζεται το ελληνικό δημόσιο.

**QE (Quantitative Easing)**: Πρόγραμμα ποσοτικής χαλάρωσης της ΕΚΤ όπου η κεντρική τράπεζα αγοράζει κρατικά ομόλογα για να τονώσει την οικονομία. Βοηθά στη μείωση των επιτοκίων.
"""

# Test viewpoints markdown
viewpoints_markdown = """
## Ανάλυση Θέματος
Το άρθρο εξετάζει την πρόταση για αύξηση του κατώτατου μισθού και τις επιπτώσεις της στην οικονομία.

## Εναλλακτικές Οπτικές

### Υποστηρικτική Άποψη
Τα εργατικά συνδικάτα και η αντιπολίτευση υποστηρίζουν ότι η αύξηση είναι απαραίτητη για την αντιμετώπιση του πληθωρισμού. Επισημαίνουν ότι οι εργαζόμενοι έχουν χάσει αγοραστική δύναμη και χρειάζονται άμεση στήριξη.

### Κριτική Προσέγγιση
Οι εργοδοτικές οργανώσεις προειδοποιούν ότι μια απότομη αύξηση θα οδηγήσει σε απολύσεις και κλείσιμο μικρών επιχειρήσεων. Ζητούν σταδιακές αυξήσεις με παράλληλες φοροελαφρύνσεις.

### Ουδέτερη Άποψη
Οικονομολόγοι προτείνουν συνδυασμό μέτρων: μέτρια αύξηση μισθών με ταυτόχρονη μείωση εργοδοτικών εισφορών και στοχευμένα επιδόματα για ευάλωτες ομάδες.

## Κύριες Πηγές
- ΓΣΕΕ: Υποστηρίζει αύξηση 15% άμεσα
- ΣΕΒ: Προτείνει αύξηση 5% σε δύο δόσεις
- ΙΟΒΕ: Μελέτη για επιπτώσεις στην απασχόληση
"""

def test_parser(parser, markdown, name):
    print(f"\n{'='*60}")
    print(f"Testing {name} Parser")
    print(f"{'='*60}")
    
    result = parser.parse(markdown)
    
    import json
    print(json.dumps(result, ensure_ascii=False, indent=2))
    print(f"\n✅ {name} parsing completed successfully")

if __name__ == "__main__":
    # Test all parsers
    test_parser(FactCheckParser(), fact_check_markdown, "Fact-Check")
    test_parser(JargonParser(), jargon_markdown, "Jargon")
    test_parser(ViewpointsParser(), viewpoints_markdown, "Viewpoints")
    
    print("\n" + "="*60)
    print("✅ All markdown parsing tests completed!")
    print("="*60)